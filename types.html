<!DOCTYPE html>

<html>
<head>
  <title>types.ts</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="https://cdn.jsdelivr.net/npm/docco-next@0.9.3/layouts/parallel/docco.css" />
  <style>
    h1,h2,h3,h4,h5 {
      text-transform: none;
    }
    div.annotation pre {
        margin: 15px 0 15px;
        padding-left: 15px;
        background: #f5f5fe;
        box-shadow: none;
        border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>types.ts</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { DB } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./relational&quot;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IQBase {
  <span class="hljs-attr">db</span>: DB;
  compiledSchema: <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;
  queryHandlers: <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">Function</span>&gt;&gt;;
  queries: <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">string</span>, [ISelectQuery, <span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>]&gt;;
  observe: <span class="hljs-built_in">Function</span>;
  schema: ISchemaDefinition;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> ISchemaDefinition {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  tables: ITableDefinition[];
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> ITableDefinition {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  primaryKey?: <span class="hljs-built_in">string</span>[];
  columns: IColumnDefinition[];
  indexes?: IIndex[];
  relations?: ITableRelation[];
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IColumnDefinition {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">type</span>: <span class="hljs-string">&quot;NUMBER&quot;</span> | <span class="hljs-string">&quot;INTEGER&quot;</span> | <span class="hljs-string">&quot;STRING&quot;</span> | <span class="hljs-string">&quot;BOOLEAN&quot;</span> | <span class="hljs-string">&quot;DATE_TIME&quot;</span> | <span class="hljs-string">&quot;OBJECT&quot;</span>;
  nullable?: <span class="hljs-built_in">boolean</span>;
  foreignKey?: IForeignKeyDefinition;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IIndex {
  <span class="hljs-attr">kind</span>: <span class="hljs-string">&quot;INDEX&quot;</span>;
  name: <span class="hljs-built_in">string</span>;
  columns: [<span class="hljs-built_in">string</span>, ORDER?][];
  unique?: <span class="hljs-built_in">boolean</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h2 id="relations">Relations</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>They can be Many to Many, Has Many, Belongs To, Has One Options are described as follows</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-built_in">enum</span> R {
  HM,
  BT,
  H1,
  MTM,
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> HasManyOptions {
  <span class="hljs-attr">foreignKey</span>: <span class="hljs-built_in">string</span>;
  tableName: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> HasOneOptions {
  <span class="hljs-attr">foreignKey</span>: <span class="hljs-built_in">string</span>;
  tableName: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> BelongsOptions {
  <span class="hljs-attr">foreignKey</span>: <span class="hljs-built_in">string</span>;
  tableName: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> ManyToManyOptions {
  <span class="hljs-attr">remoteKey</span>: <span class="hljs-built_in">string</span>;
  localKey: <span class="hljs-built_in">string</span>;
  tableName: <span class="hljs-built_in">string</span>;
  through: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> ORDER = <span class="hljs-string">&quot;ASC&quot;</span> | <span class="hljs-string">&quot;DESC&quot;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> ITableRelation =
  | [R.HM, <span class="hljs-built_in">string</span>, HasManyOptions]
  | [R.BT, <span class="hljs-built_in">string</span>, BelongsOptions]
  | [R.H1, <span class="hljs-built_in">string</span>, HasOneOptions]
  | IManyToMany;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IManyToMany = [R.MTM, <span class="hljs-built_in">string</span>, ManyToManyOptions];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IForeignKeyDefinition {
  <span class="hljs-attr">ref</span>: <span class="hljs-built_in">string</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <h2 id="query-matchers">Query Matchers</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>MongoDB styled query matches</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-built_in">enum</span> M {
  $and,
  $or,
  $eq,
  $neq = <span class="hljs-string">&quot;$neq&quot;</span>,
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IAndQuery = [M.$and, IPredicate[]];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IOrQuery = [M.$or, IPredicate[]];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IEqQuery = [M.$eq, <span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> INeqQuery = [M.$neq, <span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IPredicate = IAndQuery | IOrQuery | IEqQuery | INeqQuery;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <h2 id="queries">Queries</h2>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>Queries supported are SELECT, UPDATE, INSERT, DESTROY</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-built_in">enum</span> Q {
  SELECT,
  UPDATE,
  INSERT,
  DESTROY,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> ISelectCriterion {
  <span class="hljs-attr">columns</span>: <span class="hljs-built_in">string</span>[];
  order?: [<span class="hljs-built_in">string</span>, ORDER]; <span class="hljs-comment">// NIMP</span>
  includes?: <span class="hljs-built_in">string</span>[];
  predicate?: IPredicate;
  limit?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// NIMP</span>
  skip?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// NIMP</span>
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> ISelectQuery = [Q.SELECT, <span class="hljs-built_in">string</span>, ISelectCriterion];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IInsertQuery = [Q.INSERT, <span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>[]];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IUpdateCiterion {
  <span class="hljs-attr">values</span>: <span class="hljs-built_in">Array</span>&lt;[<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>]&gt;;
  predicate: IPredicate;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IUpdateQuery = [Q.UPDATE, <span class="hljs-built_in">string</span>, IUpdateCiterion];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IDestroyCiterion {
  <span class="hljs-attr">predicate</span>: IPredicate;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IDestroyQuery = [Q.DESTROY, <span class="hljs-built_in">string</span>, IDestroyCiterion];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> IQuery = ISelectQuery | IInsertQuery | IUpdateQuery | IDestroyQuery;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
